import { WorklistItem, QueueStats, WorklistView } from "@/types/worklist";

const now = new Date();
const ago = (minutes: number) => new Date(now.getTime() - minutes * 60000).toISOString();
const later = (minutes: number) => new Date(now.getTime() + minutes * 60000).toISOString();

export const mockWorklistItems: WorklistItem[] = [
  // URGENT REFERRALS - Linked to actual referrals
  {
    id: "wl-1",
    faxId: "fax-2",
    category: "referral",
    isUrgent: true,
    queuePosition: 1,
    priorityScore: 98,
    priority: "urgent",
    slaDeadline: later(15),
    slaStatus: "red",
    claimable: true,
    patientName: "Michael Singh",
    referringPhysician: "Dr. Lisa Wong",
    clinicName: "Toronto General Hospital ED",
    documentType: "Referral",
    pageCount: 5,
    receivedAt: ago(60),
    description: "Urgent - Unstable angina, triple vessel disease, dynamic ECG changes",
    referralId: "ref-1",
    completenessScore: 100,
    pendingCommunications: 0,
  },
  {
    id: "wl-2",
    faxId: "fax-3",
    category: "referral",
    isUrgent: true,
    queuePosition: 2,
    priorityScore: 91,
    priority: "urgent",
    slaDeadline: later(45),
    slaStatus: "yellow",
    claimable: true,
    patientName: "Jean-Luc Tremblay",
    referringPhysician: "Dr. Karim Ramji",
    clinicName: "Hamilton Family Health Team",
    documentType: "Referral",
    pageCount: 3,
    receivedAt: ago(150),
    description: "Decompensated heart failure - Missing BNP and Echo",
    referralId: "ref-2",
    completenessScore: 60,
    pendingCommunications: 1,
  },
  {
    id: "wl-3",
    faxId: "fax-5",
    category: "referral",
    isUrgent: true,
    queuePosition: 3,
    priorityScore: 89,
    priority: "urgent",
    slaDeadline: later(60),
    slaStatus: "yellow",
    claimable: true,
    patientName: "Victor Kozlov",
    referringPhysician: "Dr. Patrick Murphy",
    clinicName: "St. Michael's Hospital ED",
    documentType: "Referral",
    pageCount: 5,
    receivedAt: ago(105),
    description: "TAVI assessment - Severe AS with syncope, awaiting CT Aorta",
    referralId: "ref-3",
    completenessScore: 80,
    pendingCommunications: 1,
  },

  // URGENT UNCLASSIFIED (needs triage but is urgent)
  {
    id: "wl-4",
    faxId: "fax-urgent-2",
    category: "unclassified",
    isUrgent: true,
    queuePosition: 4,
    priorityScore: 95,
    priority: "urgent",
    slaDeadline: later(25),
    slaStatus: "red",
    claimable: true,
    patientName: "Maria Santos",
    referringPhysician: "Dr. James Wong",
    clinicName: "Scarborough General ED",
    documentType: undefined,
    suggestedDocType: "Critical Lab Results",
    suggestedDocTypeConfidence: 89,
    pageCount: 2,
    receivedAt: ago(35),
    description: "Urgent - Critical potassium level 6.8",
  },

  // UNCLASSIFIED items (AI unsure of doc type)
  {
    id: "wl-5",
    faxId: "fax-triage-1",
    category: "unclassified",
    isUrgent: false,
    queuePosition: 5,
    priorityScore: 72,
    priority: "routine",
    slaDeadline: later(180),
    slaStatus: "green",
    claimable: true,
    patientName: "Jennifer Lee",
    clinicName: "Markham Village Medical",
    documentType: undefined,
    suggestedDocType: "Lab Results",
    suggestedDocTypeConfidence: 58,
    pageCount: 3,
    receivedAt: ago(45),
    description: "Unclear document type - possibly lab results or referral",
    hasPatientInfoUpdate: true,
    patientInfoUpdateType: "address",
  },
  {
    id: "wl-6",
    faxId: "fax-9",
    category: "unclassified",
    isUrgent: false,
    queuePosition: 6,
    priorityScore: 68,
    priority: "routine",
    slaDeadline: later(220),
    slaStatus: "green",
    claimable: true,
    patientName: "Unknown",
    referringPhysician: "Dr. James MacLeod",
    clinicName: "Dundas Medical Centre",
    documentType: undefined,
    suggestedDocType: "Referral Form",
    suggestedDocTypeConfidence: 42,
    pageCount: 2,
    receivedAt: ago(120),
    description: "Poor fax quality - patient name illegible, doc type unclear",
    referralId: "ref-5",
  },
  {
    id: "wl-7",
    faxId: "fax-triage-3",
    category: "unclassified",
    isUrgent: false,
    queuePosition: 7,
    priorityScore: 65,
    priority: "routine",
    slaDeadline: later(240),
    slaStatus: "green",
    claimable: true,
    patientName: "Michael Brown",
    referringPhysician: "Dr. K. Patel",
    clinicName: "North York Medical Clinic",
    documentType: undefined,
    suggestedDocType: "Holter Report",
    suggestedDocTypeConfidence: 71,
    pageCount: 8,
    receivedAt: ago(75),
    description: "Possibly Holter report or stress test results",
  },
  {
    id: "wl-8",
    faxId: "fax-triage-4",
    category: "unclassified",
    isUrgent: false,
    queuePosition: 8,
    priorityScore: 55,
    priority: "routine",
    slaDeadline: later(300),
    slaStatus: "green",
    claimable: true,
    patientName: "Susan Taylor",
    clinicName: "College Street Medical",
    documentType: undefined,
    suggestedDocType: "Correspondence",
    suggestedDocTypeConfidence: 34,
    pageCount: 2,
    receivedAt: ago(120),
    description: "Cover page only visible - cannot determine content",
  },

  // ROUTINE REFERRALS - Linked to actual referrals
  {
    id: "wl-9",
    faxId: "fax-7",
    category: "referral",
    isUrgent: false,
    queuePosition: 9,
    priorityScore: 78,
    priority: "routine",
    slaDeadline: later(180),
    slaStatus: "green",
    claimable: true,
    patientName: "Marie Gagnon",
    referringPhysician: "Dr. Sarah Chen",
    clinicName: "Pacific Family Practice",
    documentType: "Referral",
    pageCount: 4,
    receivedAt: ago(45),
    description: "Chest pain on exertion - Complete referral, ready for routing",
    referralId: "ref-4",
    completenessScore: 100,
    pendingCommunications: 0,
  },
  {
    id: "wl-10",
    faxId: "fax-10",
    category: "referral",
    isUrgent: false,
    queuePosition: 10,
    priorityScore: 75,
    priority: "routine",
    slaDeadline: later(150),
    slaStatus: "green",
    claimable: true,
    patientName: "Oluwaseun Adeyemi",
    referringPhysician: "Dr. Deepak Gupta",
    clinicName: "Brampton Internal Medicine",
    documentType: "Referral",
    pageCount: 4,
    receivedAt: ago(165),
    description: "Aortic stenosis assessment - Missing bloodwork",
    referralId: "ref-6",
    completenessScore: 80,
    pendingCommunications: 1,
    hasPatientInfoUpdate: true,
    patientInfoUpdateType: "phone",
  },
  {
    id: "wl-11",
    faxId: "fax-16",
    category: "referral",
    isUrgent: false,
    queuePosition: 11,
    priorityScore: 70,
    priority: "routine",
    slaDeadline: later(200),
    slaStatus: "green",
    claimable: false,
    claimedBy: "Dr. Anika Patel",
    patientName: "Anya Kowalski",
    referringPhysician: "Dr. Priya Kapoor",
    clinicName: "Burnaby Medical Centre",
    documentType: "Referral",
    pageCount: 4,
    receivedAt: ago(360),
    description: "Syncope workup - Accepted for Holter and tilt table",
    referralId: "ref-7",
    completenessScore: 100,
    pendingCommunications: 0,
  },
  {
    id: "wl-12",
    faxId: "fax-19",
    category: "referral",
    isUrgent: false,
    queuePosition: 12,
    priorityScore: 65,
    priority: "routine",
    slaDeadline: later(280),
    slaStatus: "green",
    claimable: false,
    claimedBy: "Dr. Marcus Chen",
    patientName: "Ahmed Ibrahim",
    referringPhysician: "Dr. Michael O'Sullivan",
    clinicName: "Riverside Family Practice",
    documentType: "Referral",
    pageCount: 3,
    receivedAt: ago(480),
    description: "BAV monitoring - Appointment booked Mar 15",
    referralId: "ref-8",
    completenessScore: 100,
    pendingCommunications: 0,
  },
  {
    id: "wl-13",
    faxId: "fax-24",
    category: "referral",
    isUrgent: false,
    queuePosition: 13,
    priorityScore: 62,
    priority: "routine",
    slaDeadline: later(320),
    slaStatus: "green",
    claimable: false,
    claimedBy: "Dr. Anika Patel",
    patientName: "James O'Brien",
    referringPhysician: "Dr. Amira Benali",
    clinicName: "Ottawa General Internal Med",
    documentType: "Referral",
    pageCount: 5,
    receivedAt: ago(1800),
    description: "Pulmonary hypertension - Accepted for RHC",
    referralId: "ref-9",
    completenessScore: 100,
    pendingCommunications: 0,
  },

  // Declined referral (still in worklist for reference)
  {
    id: "wl-14",
    faxId: "fax-26",
    category: "referral",
    isUrgent: false,
    queuePosition: 14,
    priorityScore: 30,
    priority: "routine",
    slaDeadline: later(500),
    slaStatus: "green",
    claimable: false,
    claimedBy: "Dr. Marcus Chen",
    patientName: "Priya Sharma",
    referringPhysician: "Dr. Emily Turner",
    clinicName: "Lakeshore Community Health",
    documentType: "Referral",
    pageCount: 3,
    receivedAt: ago(2940), // ~49 hours
    description: "Declined - Low pre-test probability for cardiac etiology",
    referralId: "ref-10",
    completenessScore: 100,
    pendingCommunications: 0,
  },

  // Additional unclassified items for variety
  {
    id: "wl-16",
    faxId: "fax-misc-1",
    category: "unclassified",
    isUrgent: false,
    queuePosition: 15,
    priorityScore: 48,
    priority: "routine",
    slaDeadline: later(360),
    slaStatus: "green",
    claimable: true,
    patientName: "Linda Thompson",
    referringPhysician: "Dr. Robert Bouchard",
    clinicName: "Waterloo Family Health",
    documentType: undefined,
    suggestedDocType: "Echocardiogram Report",
    suggestedDocTypeConfidence: 82,
    pageCount: 4,
    receivedAt: ago(200),
    description: "Likely echo report - No cover sheet, no patient DOB",
  },
  {
    id: "wl-17",
    faxId: "fax-misc-2",
    category: "unclassified",
    isUrgent: false,
    queuePosition: 16,
    priorityScore: 42,
    priority: "routine",
    slaDeadline: later(400),
    slaStatus: "green",
    claimable: true,
    patientName: "George Kim",
    clinicName: "Vaughan Internal Med Group",
    documentType: undefined,
    suggestedDocType: "Stress Test",
    suggestedDocTypeConfidence: 67,
    pageCount: 6,
    receivedAt: ago(280),
    description: "Stress test or nuclear imaging - Multiple pages with graphs",
  },
];

export const mockQueueStats: QueueStats = {
  totalItems: mockWorklistItems.length,
  unclassifiedCount: mockWorklistItems.filter((i) => i.category === "unclassified").length,
  referralCount: mockWorklistItems.filter((i) => i.category === "referral").length,
  urgentCount: mockWorklistItems.filter((i) => i.isUrgent).length,
  averageWaitMinutes: 127,
  slaBreachCount: 1,
  itemsProcessedToday: 34,
  itemsProcessedThisHour: 5,
};

export function getWorklistByView(view: WorklistView): WorklistItem[] {
  let items = mockWorklistItems;

  if (view !== "all") {
    items = items.filter((item) => item.category === view);
  }

  // Sort by: urgent first, then by priority score
  return items.sort((a, b) => {
    // Urgent items always come first
    if (a.isUrgent && !b.isUrgent) return -1;
    if (!a.isUrgent && b.isUrgent) return 1;
    // Then by priority score
    return b.priorityScore - a.priorityScore;
  });
}
