import {
  CerebrumPatient,
  PatientWithUpdates,
  PatientFeedStats,
  PatientInfoUpdate,
} from "@/types/patient-sync";
import { subDays, subHours, formatISO } from "date-fns";

const now = new Date();

// Helper to generate dates
const daysAgo = (days: number) => formatISO(subDays(now, days));
const hoursAgo = (hours: number) => formatISO(subHours(now, hours));

// Mock patient data with realistic Ontario information
export const mockCerebrumPatients: PatientWithUpdates[] = [
  {
    id: "pat-1",
    cerebrumId: "CER-12345",
    firstName: "Giuseppe",
    lastName: "Romano",
    dateOfBirth: "1958-03-15",
    gender: "male",
    phone: "(416) 555-0123",
    email: "g.romano@email.com",
    address: {
      street: "45 Maple Avenue",
      city: "Toronto",
      province: "ON",
      postalCode: "M5V 2T3",
    },
    healthCardNumber: "1234-567-890-AB",
    healthCardVersion: "AB",
    healthCardExpiry: "2026-03-15",
    syncStatus: "synced",
    lastSyncedAt: hoursAgo(2),
    totalFaxes: 12,
    totalReferrals: 3,
    lastFaxDate: daysAgo(1),
    lastReferralDate: daysAgo(5),
  },
  {
    id: "pat-2",
    cerebrumId: "CER-12346",
    firstName: "Margaret",
    lastName: "Chen",
    dateOfBirth: "1972-08-22",
    gender: "female",
    phone: "(905) 555-0456",
    email: "m.chen@email.com",
    address: {
      street: "123 Oak Street",
      city: "Mississauga",
      province: "ON",
      postalCode: "L5B 1M3",
    },
    healthCardNumber: "2345-678-901-CD",
    healthCardVersion: "CD",
    healthCardExpiry: "2025-08-22",
    syncStatus: "info-update",
    lastSyncedAt: hoursAgo(4),
    totalFaxes: 8,
    totalReferrals: 2,
    lastFaxDate: hoursAgo(6),
    pendingUpdates: [
      {
        field: "phone",
        oldValue: "(905) 555-0456",
        newValue: "(416) 555-9876",
        sourceDocumentId: "fax-15",
        sourceDocumentType: "Referral Letter",
        detectedAt: hoursAgo(6),
        applied: false,
      },
    ],
  },
  {
    id: "pat-3",
    cerebrumId: "CER-12347",
    firstName: "Robert",
    lastName: "Thompson",
    dateOfBirth: "1965-11-30",
    gender: "male",
    phone: "(647) 555-0789",
    address: {
      street: "789 Queen Street West",
      city: "Toronto",
      province: "ON",
      postalCode: "M6J 1G1",
    },
    healthCardNumber: "3456-789-012-EF",
    healthCardVersion: "EF",
    healthCardExpiry: "2025-11-30",
    syncStatus: "synced",
    lastSyncedAt: hoursAgo(1),
    totalFaxes: 5,
    totalReferrals: 1,
    lastFaxDate: daysAgo(3),
    lastReferralDate: daysAgo(14),
  },
  {
    id: "pat-4",
    cerebrumId: "CER-12348",
    firstName: "Priya",
    lastName: "Patel",
    dateOfBirth: "1980-04-12",
    gender: "female",
    phone: "(416) 555-1234",
    email: "priya.patel@email.com",
    address: {
      street: "567 Bloor Street East",
      city: "Toronto",
      province: "ON",
      postalCode: "M4W 1J7",
    },
    healthCardNumber: "4567-890-123-GH",
    healthCardVersion: "GH",
    healthCardExpiry: "2027-04-12",
    syncStatus: "new",
    lastSyncedAt: hoursAgo(3),
    createdInBlairAt: hoursAgo(3),
    totalFaxes: 2,
    totalReferrals: 1,
    lastFaxDate: hoursAgo(3),
  },
  {
    id: "pat-5",
    cerebrumId: "CER-12349",
    firstName: "William",
    lastName: "O'Brien",
    dateOfBirth: "1955-07-08",
    gender: "male",
    phone: "(905) 555-5678",
    address: {
      street: "321 Dundas Street",
      city: "Oakville",
      province: "ON",
      postalCode: "L6J 4Z5",
    },
    healthCardNumber: "5678-901-234-IJ",
    healthCardVersion: "IJ",
    healthCardExpiry: "2024-07-08",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(1),
    totalFaxes: 15,
    totalReferrals: 4,
    lastFaxDate: daysAgo(2),
    lastReferralDate: daysAgo(7),
  },
  {
    id: "pat-6",
    cerebrumId: "CER-12350",
    firstName: "Sandra",
    lastName: "Kim",
    dateOfBirth: "1968-02-28",
    gender: "female",
    phone: "(416) 555-9012",
    email: "s.kim@email.com",
    address: {
      street: "890 Yonge Street",
      city: "Toronto",
      province: "ON",
      postalCode: "M4W 2H2",
    },
    healthCardNumber: "6789-012-345-KL",
    healthCardVersion: "KL",
    healthCardExpiry: "2026-02-28",
    syncStatus: "info-update",
    lastSyncedAt: hoursAgo(8),
    totalFaxes: 6,
    totalReferrals: 2,
    lastFaxDate: hoursAgo(8),
    pendingUpdates: [
      {
        field: "address",
        oldValue: "890 Yonge Street, Toronto, ON M4W 2H2",
        newValue: "1200 Bay Street, Toronto, ON M5R 2A5",
        sourceDocumentId: "fax-18",
        sourceDocumentType: "Lab Results",
        detectedAt: hoursAgo(8),
        applied: false,
      },
    ],
  },
  {
    id: "pat-7",
    cerebrumId: "CER-12351",
    firstName: "Michael",
    lastName: "Santos",
    dateOfBirth: "1975-09-15",
    gender: "male",
    phone: "(647) 555-3456",
    address: {
      street: "456 College Street",
      city: "Toronto",
      province: "ON",
      postalCode: "M6G 1A4",
    },
    healthCardNumber: "7890-123-456-MN",
    healthCardVersion: "MN",
    healthCardExpiry: "2025-09-15",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(2),
    totalFaxes: 9,
    totalReferrals: 3,
    lastFaxDate: daysAgo(4),
    lastReferralDate: daysAgo(10),
  },
  {
    id: "pat-8",
    cerebrumId: "CER-12352",
    firstName: "Helen",
    lastName: "Kowalski",
    dateOfBirth: "1962-12-05",
    gender: "female",
    phone: "(905) 555-7890",
    email: "helen.k@email.com",
    address: {
      street: "234 Lakeshore Road",
      city: "Burlington",
      province: "ON",
      postalCode: "L7R 1A3",
    },
    healthCardNumber: "8901-234-567-OP",
    healthCardVersion: "OP",
    healthCardExpiry: "2026-12-05",
    syncStatus: "synced",
    lastSyncedAt: hoursAgo(12),
    totalFaxes: 4,
    totalReferrals: 1,
    lastFaxDate: daysAgo(5),
  },
  {
    id: "pat-9",
    cerebrumId: "CER-12353",
    firstName: "James",
    lastName: "Nguyen",
    dateOfBirth: "1970-06-18",
    gender: "male",
    phone: "(416) 555-2345",
    address: {
      street: "678 Spadina Avenue",
      city: "Toronto",
      province: "ON",
      postalCode: "M5S 2H9",
    },
    healthCardNumber: "9012-345-678-QR",
    healthCardVersion: "QR",
    healthCardExpiry: "2025-06-18",
    syncStatus: "new",
    lastSyncedAt: hoursAgo(5),
    createdInBlairAt: hoursAgo(5),
    totalFaxes: 1,
    totalReferrals: 1,
    lastFaxDate: hoursAgo(5),
    lastReferralDate: hoursAgo(5),
  },
  {
    id: "pat-10",
    cerebrumId: "CER-12354",
    firstName: "Elizabeth",
    lastName: "Brown",
    dateOfBirth: "1958-01-22",
    gender: "female",
    phone: "(905) 555-6789",
    email: "e.brown@email.com",
    address: {
      street: "901 King Street West",
      city: "Hamilton",
      province: "ON",
      postalCode: "L8P 1C7",
    },
    healthCardNumber: "0123-456-789-ST",
    healthCardVersion: "ST",
    healthCardExpiry: "2024-01-22",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(3),
    totalFaxes: 11,
    totalReferrals: 3,
    lastFaxDate: daysAgo(6),
    lastReferralDate: daysAgo(12),
  },
  {
    id: "pat-11",
    cerebrumId: "CER-12355",
    firstName: "David",
    lastName: "Martinez",
    dateOfBirth: "1982-05-30",
    gender: "male",
    phone: "(647) 555-8901",
    address: {
      street: "345 Parliament Street",
      city: "Toronto",
      province: "ON",
      postalCode: "M5A 3A4",
    },
    healthCardNumber: "1234-567-890-UV",
    healthCardVersion: "UV",
    healthCardExpiry: "2027-05-30",
    syncStatus: "synced",
    lastSyncedAt: hoursAgo(6),
    totalFaxes: 3,
    totalReferrals: 1,
    lastFaxDate: daysAgo(2),
  },
  {
    id: "pat-12",
    cerebrumId: "CER-12356",
    firstName: "Catherine",
    lastName: "Wilson",
    dateOfBirth: "1973-10-14",
    gender: "female",
    phone: "(416) 555-0147",
    email: "c.wilson@email.com",
    address: {
      street: "567 St. Clair Avenue West",
      city: "Toronto",
      province: "ON",
      postalCode: "M6C 1A1",
    },
    healthCardNumber: "2345-678-901-WX",
    healthCardVersion: "WX",
    healthCardExpiry: "2025-10-14",
    syncStatus: "info-update",
    lastSyncedAt: hoursAgo(10),
    totalFaxes: 7,
    totalReferrals: 2,
    lastFaxDate: hoursAgo(10),
    pendingUpdates: [
      {
        field: "healthCard",
        oldValue: "2345-678-901-WX",
        newValue: "2345-678-901-YZ",
        sourceDocumentId: "fax-22",
        sourceDocumentType: "Insurance Update",
        detectedAt: hoursAgo(10),
        applied: false,
      },
    ],
  },
  {
    id: "pat-13",
    cerebrumId: "CER-12357",
    firstName: "Richard",
    lastName: "Lee",
    dateOfBirth: "1960-08-03",
    gender: "male",
    phone: "(905) 555-2580",
    address: {
      street: "789 Main Street",
      city: "Brampton",
      province: "ON",
      postalCode: "L6X 1N4",
    },
    healthCardNumber: "3456-789-012-YZ",
    healthCardVersion: "YZ",
    healthCardExpiry: "2026-08-03",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(4),
    totalFaxes: 8,
    totalReferrals: 2,
    lastFaxDate: daysAgo(7),
    lastReferralDate: daysAgo(20),
  },
  {
    id: "pat-14",
    cerebrumId: "CER-12358",
    firstName: "Jennifer",
    lastName: "Taylor",
    dateOfBirth: "1978-03-25",
    gender: "female",
    phone: "(647) 555-3691",
    email: "j.taylor@email.com",
    address: {
      street: "123 Eglinton Avenue East",
      city: "Toronto",
      province: "ON",
      postalCode: "M4P 1J3",
    },
    healthCardNumber: "4567-890-123-AB",
    healthCardVersion: "AB",
    healthCardExpiry: "2025-03-25",
    syncStatus: "synced",
    lastSyncedAt: hoursAgo(18),
    totalFaxes: 5,
    totalReferrals: 1,
    lastFaxDate: daysAgo(8),
  },
  {
    id: "pat-15",
    cerebrumId: "CER-12359",
    firstName: "Thomas",
    lastName: "Anderson",
    dateOfBirth: "1967-11-11",
    gender: "male",
    phone: "(416) 555-4802",
    address: {
      street: "456 Finch Avenue West",
      city: "North York",
      province: "ON",
      postalCode: "M3J 2V5",
    },
    healthCardNumber: "5678-901-234-CD",
    healthCardVersion: "CD",
    healthCardExpiry: "2024-11-11",
    syncStatus: "new",
    lastSyncedAt: hoursAgo(1),
    createdInBlairAt: hoursAgo(1),
    totalFaxes: 1,
    totalReferrals: 0,
    lastFaxDate: hoursAgo(1),
  },
  {
    id: "pat-16",
    cerebrumId: "CER-12360",
    firstName: "Susan",
    lastName: "Garcia",
    dateOfBirth: "1985-07-19",
    gender: "female",
    phone: "(905) 555-5913",
    email: "s.garcia@email.com",
    address: {
      street: "890 Dundas Street East",
      city: "Whitby",
      province: "ON",
      postalCode: "L1N 2K1",
    },
    healthCardNumber: "6789-012-345-EF",
    healthCardVersion: "EF",
    healthCardExpiry: "2027-07-19",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(1),
    totalFaxes: 4,
    totalReferrals: 1,
    lastFaxDate: daysAgo(3),
    lastReferralDate: daysAgo(15),
  },
  {
    id: "pat-17",
    cerebrumId: "CER-12361",
    firstName: "Daniel",
    lastName: "Robinson",
    dateOfBirth: "1952-04-07",
    gender: "male",
    phone: "(647) 555-6024",
    address: {
      street: "234 Lawrence Avenue East",
      city: "Scarborough",
      province: "ON",
      postalCode: "M1P 2P8",
    },
    healthCardNumber: "7890-123-456-GH",
    healthCardVersion: "GH",
    healthCardExpiry: "2024-04-07",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(5),
    totalFaxes: 14,
    totalReferrals: 5,
    lastFaxDate: daysAgo(9),
    lastReferralDate: daysAgo(25),
  },
  {
    id: "pat-18",
    cerebrumId: "CER-12362",
    firstName: "Nancy",
    lastName: "White",
    dateOfBirth: "1969-09-28",
    gender: "female",
    phone: "(416) 555-7135",
    email: "n.white@email.com",
    address: {
      street: "567 Bathurst Street",
      city: "Toronto",
      province: "ON",
      postalCode: "M5S 2P8",
    },
    healthCardNumber: "8901-234-567-IJ",
    healthCardVersion: "IJ",
    healthCardExpiry: "2025-09-28",
    syncStatus: "synced",
    lastSyncedAt: hoursAgo(20),
    totalFaxes: 6,
    totalReferrals: 2,
    lastFaxDate: daysAgo(4),
    lastReferralDate: daysAgo(11),
  },
  {
    id: "pat-19",
    cerebrumId: "CER-12363",
    firstName: "Joseph",
    lastName: "Harris",
    dateOfBirth: "1974-12-16",
    gender: "male",
    phone: "(905) 555-8246",
    address: {
      street: "901 Steeles Avenue West",
      city: "Vaughan",
      province: "ON",
      postalCode: "L4J 7L5",
    },
    healthCardNumber: "9012-345-678-KL",
    healthCardVersion: "KL",
    healthCardExpiry: "2026-12-16",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(2),
    totalFaxes: 3,
    totalReferrals: 1,
    lastFaxDate: daysAgo(6),
  },
  {
    id: "pat-20",
    cerebrumId: "CER-12364",
    firstName: "Barbara",
    lastName: "Clark",
    dateOfBirth: "1963-06-02",
    gender: "female",
    phone: "(647) 555-9357",
    email: "b.clark@email.com",
    address: {
      street: "123 Weston Road",
      city: "York",
      province: "ON",
      postalCode: "M9N 1A8",
    },
    healthCardNumber: "0123-456-789-MN",
    healthCardVersion: "MN",
    healthCardExpiry: "2025-06-02",
    syncStatus: "synced",
    lastSyncedAt: hoursAgo(14),
    totalFaxes: 10,
    totalReferrals: 3,
    lastFaxDate: daysAgo(1),
    lastReferralDate: daysAgo(8),
  },
  {
    id: "pat-21",
    cerebrumId: "CER-12365",
    firstName: "Mark",
    lastName: "Lewis",
    dateOfBirth: "1957-02-09",
    gender: "male",
    phone: "(416) 555-0468",
    address: {
      street: "456 Victoria Park Avenue",
      city: "East York",
      province: "ON",
      postalCode: "M4E 3S7",
    },
    healthCardNumber: "1234-567-890-OP",
    healthCardVersion: "OP",
    healthCardExpiry: "2024-02-09",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(6),
    totalFaxes: 7,
    totalReferrals: 2,
    lastFaxDate: daysAgo(10),
    lastReferralDate: daysAgo(30),
  },
  {
    id: "pat-22",
    cerebrumId: "CER-12366",
    firstName: "Linda",
    lastName: "Walker",
    dateOfBirth: "1981-08-13",
    gender: "female",
    phone: "(905) 555-1579",
    email: "l.walker@email.com",
    address: {
      street: "789 Kennedy Road",
      city: "Markham",
      province: "ON",
      postalCode: "L3R 0N1",
    },
    healthCardNumber: "2345-678-901-QR",
    healthCardVersion: "QR",
    healthCardExpiry: "2027-08-13",
    syncStatus: "synced",
    lastSyncedAt: hoursAgo(16),
    totalFaxes: 2,
    totalReferrals: 1,
    lastFaxDate: daysAgo(2),
  },
  {
    id: "pat-23",
    cerebrumId: "CER-12367",
    firstName: "Steven",
    lastName: "Hall",
    dateOfBirth: "1971-05-21",
    gender: "male",
    phone: "(647) 555-2680",
    address: {
      street: "234 Sheppard Avenue East",
      city: "North York",
      province: "ON",
      postalCode: "M2J 1V1",
    },
    healthCardNumber: "3456-789-012-ST",
    healthCardVersion: "ST",
    healthCardExpiry: "2025-05-21",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(3),
    totalFaxes: 5,
    totalReferrals: 1,
    lastFaxDate: daysAgo(5),
  },
  {
    id: "pat-24",
    cerebrumId: "CER-12368",
    firstName: "Karen",
    lastName: "Young",
    dateOfBirth: "1966-10-04",
    gender: "female",
    phone: "(416) 555-3791",
    email: "k.young@email.com",
    address: {
      street: "567 Davenport Road",
      city: "Toronto",
      province: "ON",
      postalCode: "M5R 1K5",
    },
    healthCardNumber: "4567-890-123-UV",
    healthCardVersion: "UV",
    healthCardExpiry: "2026-10-04",
    syncStatus: "synced",
    lastSyncedAt: hoursAgo(22),
    totalFaxes: 9,
    totalReferrals: 3,
    lastFaxDate: daysAgo(3),
    lastReferralDate: daysAgo(14),
  },
  {
    id: "pat-25",
    cerebrumId: "CER-12369",
    firstName: "Edward",
    lastName: "King",
    dateOfBirth: "1959-01-17",
    gender: "male",
    phone: "(905) 555-4802",
    address: {
      street: "890 Hurontario Street",
      city: "Mississauga",
      province: "ON",
      postalCode: "L5G 3H4",
    },
    healthCardNumber: "5678-901-234-WX",
    healthCardVersion: "WX",
    healthCardExpiry: "2024-01-17",
    syncStatus: "synced",
    lastSyncedAt: daysAgo(4),
    totalFaxes: 12,
    totalReferrals: 4,
    lastFaxDate: daysAgo(7),
    lastReferralDate: daysAgo(18),
  },
];

// Helper functions
export function getPatientFeedStats(): PatientFeedStats {
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  const newPatientsToday = mockCerebrumPatients.filter(
    (p) =>
      p.syncStatus === "new" &&
      p.createdInBlairAt &&
      new Date(p.createdInBlairAt) >= today
  ).length;

  const patientsWithUpdates = mockCerebrumPatients.filter(
    (p) => p.syncStatus === "info-update" && p.pendingUpdates && p.pendingUpdates.length > 0
  ).length;

  const syncedPatients = mockCerebrumPatients.filter(
    (p) => p.syncStatus === "synced"
  ).length;

  return {
    totalPatients: mockCerebrumPatients.length,
    syncedPatients,
    newPatientsToday,
    patientsWithUpdates,
    lastSyncTime: hoursAgo(0),
  };
}

export function filterPatients(
  status?: "all" | "synced" | "new" | "info-update",
  searchQuery?: string
): PatientWithUpdates[] {
  let filtered = [...mockCerebrumPatients];

  // Filter by status
  if (status && status !== "all") {
    filtered = filtered.filter((p) => p.syncStatus === status);
  }

  // Filter by search query
  if (searchQuery) {
    const query = searchQuery.toLowerCase();
    filtered = filtered.filter(
      (p) =>
        p.firstName.toLowerCase().includes(query) ||
        p.lastName.toLowerCase().includes(query) ||
        `${p.firstName} ${p.lastName}`.toLowerCase().includes(query) ||
        p.healthCardNumber?.toLowerCase().includes(query) ||
        p.phone?.toLowerCase().includes(query) ||
        p.cerebrumId.toLowerCase().includes(query)
    );
  }

  return filtered;
}

export function getPatientById(id: string): PatientWithUpdates | undefined {
  return mockCerebrumPatients.find((p) => p.id === id);
}

export function getPatientByCerebrumId(
  cerebrumId: string
): PatientWithUpdates | undefined {
  return mockCerebrumPatients.find((p) => p.cerebrumId === cerebrumId);
}
